# 证券量化交易监控平台开发规范

## 一、总体原则

1. **QMT优先原则**：所有开发必须基于QMT平台进行，严格遵循QMT API文档规范，不允许脱离QMT文档进行假设性开发。
2. **文档驱动开发**：任何功能实现前必须先查阅QMT官方文档确认可行性。
3. **接口一致性**：保持与QMT API接口调用方式的一致性，不允许擅自修改接口定义。
4. **命名规范统一**：遵循QMT的命名规范，确保代码可读性和一致性。

## 二、QMT环境配置规范

1. **开发环境要求**
   - 使用QMT推荐的Python版本（3.8或以上）
   - 使用QMT提供的SDK与运行环境
   - 必须在QMT迅投终端环境下进行测试与验证

2. **环境初始化流程**
   - 正确安装QMT客户端与开发组件
   - 确保调用接口前已完成环境初始化
   - 按文档要求正确设置API调用参数

3. **依赖管理**
   - 仅使用QMT支持的第三方库
   - 记录所有依赖库的版本信息
   - 优先使用QMT内置函数库

## 三、代码编写规范

1. **模块组织**
   ```
   project/
   ├── config/            # 配置文件目录
   ├── data/              # 数据处理模块
   │   ├── market_data.py # 行情数据处理
   │   └── trade_data.py  # 交易数据处理
   ├── strategies/        # 策略模块
   ├── risk/              # 风控模块
   ├── utils/             # 工具函数
   └── main.py            # 程序入口
   ```

2. **编码风格**
   - 遵循PEP 8编码规范
   - 使用类型注解增强代码可读性
   - 函数、类、变量命名规则：
     - 类名：使用驼峰命名法（如`MarketDataHandler`）
     - 函数和变量：使用下划线命名法（如`get_market_data`）
     - 常量：全大写（如`MAX_RETRY_TIMES`）

3. **注释规范**
   - 每个文件头部必须包含功能描述、作者、日期信息
   - 函数必须有文档字符串，说明功能、参数和返回值
   - 复杂逻辑必须添加行内注释

4. **异常处理**
   - QMT API调用必须进行异常捕获
   - 记录异常信息到日志
   - 实现优雅的错误处理与恢复机制

## 四、QMT API调用规范

1. **行情模块（XtQuant.XtData）**
   - 初始化时必须检查连接状态
   - 订阅行情前必须验证合约有效性
   - 回调函数必须处理所有可能的数据类型
   - 数据获取采用异步处理模式，避免阻塞

2. **交易模块（XtQuant.Xttrade）**
   - 交易前必须验证账户登录状态
   - 所有交易操作必须有日志记录
   - 实现交易指令队列管理，防止超频
   - 订单状态变更必须有回调处理

3. **数据格式规范**
   - 严格遵循QMT数据字典定义
   - 时间戳统一使用QMT标准格式
   - 价格和数量精度按照交易所规则处理

## 五、日志规范

1. **日志级别**
   - ERROR：影响系统运行的错误
   - WARNING：不影响运行但需关注的警告
   - INFO：关键操作信息
   - DEBUG：调试信息

2. **日志内容**
   - 行情订阅与取消订阅操作
   - 交易操作（下单、撤单）
   - 账户状态变更
   - 系统异常信息
   - 性能监控数据

3. **日志存储**
   - 按日期分文件存储
   - 定期归档与清理
   - 关键操作日志需备份

## 六、测试规范

1. **单元测试**
   - 关键功能必须有单元测试
   - 测试用例需覆盖正常和异常场景
   - 模拟QMT环境进行离线测试

2. **集成测试**
   - 在模拟环境下进行全流程测试
   - 验证与QMT接口的交互
   - 测试不同市场行情数据处理

3. **性能测试**
   - 测量订阅行情的响应时间
   - 测试交易指令执行效率
   - 验证系统在高频数据下的稳定性

## 七、文档规范

1. **接口文档**
   - 记录项目中使用的所有QMT API
   - 说明接口参数和返回值
   - 提供调用示例

2. **架构文档**
   - 系统整体架构图
   - 模块间交互流程
   - 数据流向图

3. **用户文档**
   - 系统功能说明
   - 操作手册
   - 常见问题解答

## 八、版本控制规范

1. **Git提交规范**
   - 提交信息格式：`[模块]: 简要说明`
   - 每次提交专注于单一功能或修复
   - 重要变更需要详细说明

2. **分支管理**
   - main：稳定版本分支
   - develop：开发分支
   - feature/*：功能分支
   - hotfix/*：紧急修复分支

3. **版本命名**
   - 遵循语义化版本规范 (SemVer)
   - 格式：主版本.次版本.修订号 (如 1.0.2)

## 九、QMT特性适配规范

1. **API版本兼容**
   - 记录使用的QMT API版本
   - 定期检查API更新
   - 制定版本升级计划

2. **市场数据处理**
   - 按照QMT支持的市场分类处理数据
   - 考虑不同市场的交易规则差异
   - 处理好实时数据与历史数据的衔接

3. **功能扩展限制**
   - 所有功能扩展必须基于QMT已有能力
   - 不允许绕过QMT接口直接访问底层资源
   - 自定义功能必须与QMT架构保持一致

## 十、安全规范

1. **账户安全**
   - 交易凭证不得硬编码在代码中
   - 实现多重验证机制
   - 敏感信息加密存储

2. **数据安全**
   - 行情数据本地存储需加密
   - 交易记录需备份保存
   - 定期清理临时数据

3. **操作安全**
   - 实现交易限额控制
   - 异常交易监控与拦截
   - 关键操作需确认机制

## 十一、其他规范

1. **代码评审**
   - 核心功能必须经过代码评审
   - 评审重点关注QMT API使用正确性
   - 建立评审清单确保全面检查

2. **知识共享**
   - 记录QMT使用经验与问题解决方案
   - 整理QMT常见问题集
   - 定期分享QMT新特性研究成果

3. **持续集成**
   - 构建自动化测试流程
   - 实现关键模块的自动化测试
   - 定期进行全系统集成测试 